<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="styles.css">
	<title>Instructors</title>
</head>
<body>
	<div id="navbar"></div>
	<header class="clearfix">
		<h1>Instructors</h1>
		<div id="new-btn" class="new-btn">new</div>
	</header>
	<input class="searchbar" type="text" name="searchbar" placeholder="Search by name, phone, email, etc.">
	<div id="count" class="count"></div>

	<div id="list"></div>

	<div class="modal" id="newModal">
		<div class="modal-content">
			<div class="close-btn" id="close-btn">&times;</div>
			<h2>New Instructor</h2>
			<form id="new-instructor-form">
				<label>Name:
					<input type="text" name="name" placeholder="Name" autocomplete="off" required>
				</label><br><br>
				<label>Phone:
					<input type="tel" name="phone" autocomplete="off" placeholder="Phone">
				</label><br><br>
				<label>Email:
					<input type="email" name="email" autocomplete="off" placeholder="Email">
				</label><br><br>
				<label>RPT Status:
					<input class="small-input" type="checkbox" name="rpt" >
				</label><br><br>
				<label>Sponsored:
					<input class="small-input" id="sponsored" type="checkbox" name="sponsored">
				</label>
				<label id="sponsor"><br>Sponsor:
					<input type="text" name="sponsor" autocomplete="off" placeholder="Sponsor">
				</label><br><br>
				<button type="submit">Create Record</button>
			</form>

			<div id="message"></div>

		</div>
	</div>
</body>
<script>
	var form = document.getElementById('new-instructor-form');
	var message = document.getElementById('message');
	var table = 'instructors';
	var all = [];
</script>
<script src="/script.js"></script>
<script src="/form.js"></script>
<script src="/modals.js"></script>
<script>
	const searchBar = document.querySelector('.searchbar');
	searchBar.addEventListener('input', () => {
		const term = searchBar.value.toLowerCase();
		const filtered = all.filter(inst => {
			return (
				inst.name?.toLowerCase().includes(term) ||
				inst.phone?.toLowerCase().includes(term) ||
				inst.email?.toLowerCase().includes(term) ||
				(inst.rpt ? 'rpt' : '').includes(term) ||
				(inst.sponsored ? 'sponsored': '').includes(term)
			);
		});
		const count = document.getElementById('count');
		const num = filtered.length;
		count.innerHTML = `Found ${num} records.`;
		displayRecords(filtered);
	});

	function displayRecords(instructors) {
		const instList = document.getElementById('list');
		instList.innerHTML = '';

		instructors.forEach(instructor => {
			const entry = document.createElement('div');
			entry.classList.add('row');

			const name = document.createElement('span');
			if (instructor.rpt === true) {
				name.textContent = instructor.name + ', RPT';
			} else {
				name.textContent = instructor.name;
			};

			const arrow = document.createElement('span')
			arrow.innerHTML = `&#9654;`;
			arrow.classList.add("arrow");

			entry.appendChild(name);
			entry.appendChild(arrow);

			entry.addEventListener('click', () => {
				window.location.href = `/instructor-info.html?id=${instructor.id}`;
			});

			instList.appendChild(entry);
		});
		const count = document.getElementById('count');
		const num = instructors.length;
		count.innerHTML = `Found ${num} records.`;
	}

	document.addEventListener('DOMContentLoaded', loadRecords);

	const sponsored = document.getElementById('sponsored');
	const sponsor = document.getElementById('sponsor');

	sponsored.addEventListener('change', () => {
		if (sponsored.checked) {
			sponsor.style.display = 'inline-block';
		} else {
			sponsor.style.display = 'none';
		}
	});
</script>
</html>