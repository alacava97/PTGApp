<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="styles.css">
	<title>Classes</title>
</head>
<body>
	<div id="navbar"></div>
	<header class="clearfix">
		<h1>Classes</h1>
		<div id="new-btn" class="new-btn">new</div>
	</header>
	<input class="searchbar" type="text" name="searchbar" placeholder="Search by name, phone, email, etc.">
	<div id="count" class="count"></div>

	<div id="list"></div>

	<div class="modal" id="newModal">
		<div class="modal-content">
			<div class="close-btn" id="close-btn">&times;</div>
			<h2>New Class</h2>
			<form id="new-class-form">
				<label>Title:
					<input type="text" name="title" placeholder="Class Title" autocomplete="off" required>
				</label><br><br>
				<label>Instructor:
					<select id="instDropdown" name="instructor_id" required>
						<option value="" selected disabled>Select an instructor</option>
					</select>
				</label><br><br>
				<label>Type:
					<Select id="typeDropdown" name="category" required>
						<option value="" selected disabled>Select a type</option>
					</Select>
				</label><br><br>
				<label>Level:
					<select name="level" required>
						<option value="" selected disabled>Select a level</option>
						<option value="everyone">Everyone</option>
						<option value="beginner">Beginner</option>
						<option value="intermediate">Intermediate</option>
						<option value="advanced">Advanced</option>
					</select>
				</label><br><br>
				<button type="submit">Create Record</button>
			</form>

			<div id="message"></div>

		</div>
	</div>
</body>
<script>
	var form = document.getElementById('new-class-form');
	var message = document.getElementById('message');
	var table = 'classes';
	var all = [];
</script>
<script src="script.js"></script>
<script src="form.js"></script>
<script>
	const searchBar = document.querySelector('.searchbar');
	searchBar.addEventListener('input', () => {
		const term = searchBar.value.toLowerCase();
		const filtered = all.filter(entry => {
			return (
				entry.title?.toLowerCase().includes(term) ||
				entry.level?.toLowerCase().includes(term) ||
				entry.type_name?.toLowerCase().includes(term) ||
				entry.instructor_name?.toLowerCase().includes(term)
			);
		});
		const count = document.getElementById('count');
		const num = filtered.length;
		count.innerHTML = `Found ${num} records.`;
		displayRecords(filtered);
	});

	function displayRecords(records) {
		const list = document.getElementById('list');
		list.innerHTML = '';

		records.forEach(record => {
			const entry = document.createElement('div');
			entry.classList.add('row');

			const name = document.createElement('span');
			name.innerHTML = `<b>${record.title}</b><br>${record.instructor_name}`;

			const arrow = document.createElement('span')
			arrow.innerHTML = `&#9654;`;
			arrow.classList.add("arrow");

			entry.appendChild(name);
			entry.appendChild(arrow);

			entry.addEventListener('click', () => {
				window.location.href = `/class-info.html?id=${record.id}`;
			});

			list.appendChild(entry);
		});
		const count = document.getElementById('count');
		const num = records.length;
		count.innerHTML = `Found ${num} records.`;
	}

	document.addEventListener('DOMContentLoaded', loadRecords);
	document.addEventListener('DOMContentLoaded', async () => {
		const dropdown = document.getElementById('instDropdown');

		try {
			const response = await fetch('/api/read/instructors');
			if (!response.ok) throw new Error('Failed to fetch instructors');

			const instructors = await response.json();

			instructors.forEach(inst => {
				const option = document.createElement('option');
				option.value = inst.id;
				option.textContent = inst.name;
				if (inst.rpt === true) {
					option.textContent += ', RPT';
				}
				dropdown.appendChild(option);
			});
		} catch (error) {
			console.error('Error loading instructors:', error);
		}
	});

	document.addEventListener('DOMContentLoaded', () => {
		const typeDD = document.getElementById('typeDropdown');
		populateDropdown(typeDD, 'types', 'type');
	});
</script>
</html>