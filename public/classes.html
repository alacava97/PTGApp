<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
	<title>Classes</title>
</head>
<body>
	<div id="navbar"></div>
	<header class="clearfix">
		<h1>Classes</h1>
		<div id="new-btn" class="new-btn">new</div>
	</header>
	<input id="searchbar" class="searchbar" type="text" name="searchbar" placeholder="Search by title, level, type, instructor, etc.">
	<div id="count" class="count"></div>

	<div id="list"></div>

	<div class="modal" id="newModal">
		<div class="modal-content">
			<div class="close-btn" id="close-btn">&times;</div>
			<h2>New Class</h2>
			<form id="new-class-form">
				<label>Title:
					<input type="text" name="title" placeholder="Class Title" autocomplete="off" required>
				</label><br><br>
				<label>Instructor:
					<select id="instDropdown" name="instructor_ids" required multiple>
						<option value="" selected disabled>Select an instructor</option>
					</select>
				</label><br><br>
				<label>Length:
					<input type="number" min="1" max="5" name="length" required>
				</label><br><br>
				<label>Type:
					<Select id="typeDropdown" name="type" required>
						<option value="" selected disabled>Select a type</option>
					</Select>
				</label><br><br>
				<label>Level:
					<select name="level" required>
						<option value="" selected disabled>Select a level</option>
						<option value="everyone">Everyone</option>
						<option value="beginner">Beginner</option>
						<option value="intermediate">Intermediate</option>
						<option value="advanced">Advanced</option>
					</select>
				</label><br><br>
				<button type="submit">Create Record</button>
			</form>

			<div id="message"></div>

		</div>
	</div>
</body>
<script src="script.js"></script>
<script>
	document.addEventListener('DOMContentLoaded', async () => {
		//populate table with class records
		const classes = await read('classes');
		displayRecords(classes);

		//initialize searchbar
		searchBar(classes);

		//populate modal dropdowns
		const instDropdown = document.getElementById('instDropdown');
		populateDropdown(instDropdown, 'instructors', 'name');

		const typeDD = document.getElementById('typeDropdown');
		populateDropdown(typeDD, 'types', 'type');

		//wire modal form submit button
		const form = document.getElementById('new-class-form');
		form.addEventListener('submit', async (e) => {
			handleFormSubmission(e, form, `/api/create/classes`, 'POST', async () => {
				const data = await read('classes');
				displayRecords(data);
			});
		});

		modalButtons();
		openBtn('new-btn', 'newModal');
	});

	function displayRecords(records) {
		const list = document.getElementById('list');
		list.innerHTML = '';

		records.forEach(record => {
			const entry = document.createElement('div');
			entry.classList.add('row');

			const name = document.createElement('span');
			name.innerHTML = `<b>${record.title}</b><br>${record.instructor_name}`;

			const arrow = document.createElement('span')
			arrow.innerHTML = `&#9654;`;
			arrow.classList.add("arrow");

			entry.appendChild(name);
			entry.appendChild(arrow);

			entry.addEventListener('click', () => {
				window.location.href = `/class-info.html?id=${record.id}`;
			});

			list.appendChild(entry);
		});
		const count = document.getElementById('count');
		const num = records.length;
		count.innerHTML = `Found ${num} records.`;
	};
</script>
</html>