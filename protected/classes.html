<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="public/styles/styles.css">
	<link rel="stylesheet" href="public/styles/buttons.css">
	<link rel="stylesheet" href="public/styles/themes.css">
	<link rel="stylesheet" href="public/styles/modals.css">
	<link rel="stylesheet" href="public/styles/nav-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
	<title>Classes</title>
</head>
<body>
	<div id="navbar"></div>
	<header class="clearfix">
		<h1>Classes</h1>
		<div id="new-btn" class="new-btn">new</div>
	</header>
	<input id="searchbar" class="searchbar" type="text" name="searchbar" placeholder="Search by title, level, type, instructor, etc.">
	<div id="count" class="count"></div>

	<div id="list"></div>
</body>
<script src="public/js/script.js"></script>
<script src="public/js/modals.js"></script>
<script src="public/js/UI.js"></script>
<script>
	document.addEventListener('DOMContentLoaded', async () => {
		//populate table with class records
		const classes = await read('classes');
		displayRecords(classes);

		//initialize searchbar
		searchBar(classes);

		const newClass = new Modal('newModal');
		newClass.content(`<h2>New Class</h2>
			<form id="new-class-form">
				<label for="title">Title</label>
				<input id="title" type="text" name="title" placeholder="Class Title" autocomplete="off" required>
				<div class="seperator"></div>
				<label for="instDropdown">Instructor<br>(Type to search, ctrl + click to select multiple)</label>
				<select id="instDropdown" class="bigdd" name="instructor_ids" required multiple>
					<option value="" selected disabled>Select an instructor</option>
				</select>
				<div class="seperator"></div>
				<label for="length">Length</label>
				<input id="length" type="number" min="1" max="5" name="length" required>
				<div class="seperator"></div>
				<label for="typeDropdown">Type</label>
				<Select id="typeDropdown" name="type" required>
					<option value="" selected disabled>Select a type</option>
				</Select>
				<div class="seperator"></div>
				<label for="level">Level</label>
				<select id="level" name="level" required>
					<option value="" selected disabled>Select a level</option>
					<option value="introductory">Introductory</option>
					<option value="foundational">Foundational</option>
					<option value="beginner">Beginner</option>
					<option value="intermediate">Intermediate</option>
					<option value="advanced">Advanced</option>
					<option value="everyone">Everyone</option>
				</select>
				<div class="seperator"></div>
				<button type="submit" class="button">Create Record</button>
			</form>

			<div id="message"></div>`);
		document.getElementById('new-btn').addEventListener('click', () => newClass.show());
		async function classSuccess() {
			const updated = await read('classes');
			displayRecords(updated);
		}
		newClass.formSubmit(classSuccess, 'classes', type = 'create');

		//populate modal dropdowns
		const instDropdown = document.getElementById('instDropdown');
		populateDropdown(instDropdown, 'instructors', 'name');

		const typeDD = document.getElementById('typeDropdown');
		populateDropdown(typeDD, 'types', 'type');
	});

	function displayRecords(records) {
		const list = document.getElementById('list');
		list.innerHTML = '';

		Object.entries(records)
			.sort(([, a], [, b]) =>
				a.title.localeCompare(b.title, undefined, {sensitivity: 'base'})
			)
			.forEach(record => {
			record = record[1]
			const entry = new Row();

			const name = `${record.title}`
			const subtitle = `${record.instructor_name}`;

			entry.addTitle(name);
			entry.addSubtitle(subtitle);
			
			entry.addArrow(`/class-info.html?id=${record.id}`);

			list.appendChild(entry.row);
		});
		const count = document.getElementById('count');
		const num = records.length;
		count.innerHTML = `Found ${num} records.`;
	};
</script>
</html>