<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="public/styles/styles.css">
	<link rel="stylesheet" href="public/styles/buttons.css">
	<link rel="stylesheet" href="public/styles/themes.css">
	<link rel="stylesheet" href="public/styles/modals.css">
	<link rel="stylesheet" href="public/styles/nav-styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
	<title>Instructors</title>
</head>
<body>
	<div id="navbar"></div>
	<header class="clearfix">
		<h1>Instructors</h1>
		<div id="new-btn" class="new-btn">new</div>
	</header>
	<input id="searchbar" class="searchbar" type="text" name="searchbar" placeholder="Search by name, phone, email, etc.">
	<div id="count" class="count"></div>

	<div id="list"></div>
</body>
<script src="public/js/script.js"></script>
<script src="public/js/modals.js"></script>
<script src="public/js/UI.js"></script>
<script>
	document.addEventListener('DOMContentLoaded', async () => {
		//populate table with instructor records
		const instructors = await read('instructors');
		displayRecords(instructors);

		//initialize searchbar
		searchBar(instructors);

		const newInst = new Modal('newModal');
		newInst.content(`<h2>New Instructor</h2>
			<form id="new-instructor-form">
				<label for="name">Name</label>
				<input id="name" type="text" name="name" placeholder="Name" autocomplete="off" required>
				<div class="seperator"></div>

				<label for="rpt">RPT Status
					<input id="rpt" class="small-input" type="checkbox" name="rpt">
				</label>
				<div class="seperator"></div>

				<label for="phone">Phone</label>
				<input id="phone" type="tel" name="phone" autocomplete="off" placeholder="Phone">
				<div class="seperator"></div>

				<label for="email">Email</label>
				<input id="email" type="email" name="email" autocomplete="off" placeholder="Email">
				<div class="seperator"></div>

				<button type="submit" class="button modal-center">Create Record</button>
			</form>

			<div id="message"></div>`);
		document.getElementById('new-btn').addEventListener('click', () => newInst.show());
		async function instSuccess() {
			const records = await read('instructors');
			displayRecords(records);
		}
		newInst.formSubmit(instSuccess, 'instructors', type = 'create');
	})

	function displayRecords(instructors) {
		const instList = document.getElementById('list');
		instList.innerHTML = '';

		Object.entries(instructors)
			.sort(([, a], [, b]) => 
				a.name.localeCompare(b.name, undefined, {sensitivity: 'base'})
			)
			.forEach(instructor => {
			instructor = instructor[1]
			const entry = new Row();
			const name = `${instructor.name}${instructor.rpt == true ? ', RPT' : ''}`;

			entry.addTitle(name);
			entry.addArrow(`/instructor-info.html?id=${instructor.id}`);

			instList.appendChild(entry.row);
		});
		const count = document.getElementById('count');
		const num = instructors.length;
		count.innerHTML = `Found ${num} records.`;
	}


</script>
</html>