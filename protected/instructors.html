<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="public/styles/styles.css">
	<link rel="stylesheet" href="public/styles/buttons.css">
	<link rel="stylesheet" href="public/styles/themes.css">
	<link rel="stylesheet" href="public/styles/modals.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
	<title>Instructors</title>
</head>
<body>
	<div id="navbar"></div>
	<header class="clearfix">
		<h1>Instructors</h1>
		<div id="new-btn" class="new-btn">new</div>
	</header>
	<input id="searchbar" class="searchbar" type="text" name="searchbar" placeholder="Search by name, phone, email, etc.">
	<div id="count" class="count"></div>

	<div id="list"></div>
</body>
<script src="public/js/script.js"></script>
<script src="public/js/modals.js"></script>
<script src="public/js/UI.js"></script>
<script>
	document.addEventListener('DOMContentLoaded', async () => {
		//populate table with instructor records
		const instructors = await read('instructors');
		displayRecords(instructors);

		//initialize searchbar
		searchBar(instructors);

		const newInst = new Modal('newModal');
		newInst.content(`<h2>New Instructor</h2>
			<form id="new-instructor-form">
				<input type="text" name="name" placeholder="Name" autocomplete="off" required class="modal-center">
				<br><br>
					<input type="tel" name="phone" autocomplete="off" placeholder="Phone" class="modal-center">
				<br><br>
					<input type="email" name="email" autocomplete="off" placeholder="Email" class="modal-center">
				<br><br>
				<label class="modal-center">RPT Status
					<input class="small-input" type="checkbox" name="rpt" class="modal-center">
				</label><br><br>
				<label class="modal-center">Sponsored
					<input class="small-input" id="sponsored" type="checkbox" name="sponsored" class="modal-center">
				</label>
				<label id="sponsor" class="modal-center"><br>Sponsor
					<input type="text" name="sponsor" autocomplete="off" placeholder="Sponsor" class="modal-center">
				</label><br><br>
				<button type="submit" class="button modal-center">Create Record</button>
			</form>

			<div id="message"></div>`);
		document.getElementById('new-btn').addEventListener('click', () => newInst.show());

		//wire modal form submit button
		const form = document.getElementById('new-instructor-form');
		form.addEventListener('submit', async (e) => {
			handleFormSubmission(e, form, `/api/create/instructors`, 'POST', async () => {
				const data = await read('instructors');
				displayRecords(data);
				sponsorCheck();
			});
		});

		const sponsored = document.getElementById('sponsored');
		const sponsor = document.getElementById('sponsor');

		sponsored.addEventListener('change', () => {
			if (sponsored.checked) {
				sponsor.style.display = 'inline-block';
			} else {
				sponsor.style.display = 'none';
			}
		});
	})
	function displayRecords(instructors) {
		const instList = document.getElementById('list');
		instList.innerHTML = '';

		instructors.forEach(instructor => {
			const entry = new Row();

			const name = instructor.name;
			if (instructor.rpt == true) {
				name += ', RPT';
			};

			entry.addTitle(name);
			entry.addArrow(`/instructor-info.html?id=${instructor.id}`);

			instList.appendChild(entry.row);
		});
		const count = document.getElementById('count');
		const num = instructors.length;
		count.innerHTML = `Found ${num} records.`;
	}


</script>
</html>